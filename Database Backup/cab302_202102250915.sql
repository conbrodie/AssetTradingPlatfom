--
-- Script was generated by Devart dbForge Studio 2020 for MySQL, Version 9.0.304.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 25/02/2021 9:15:10 AM
-- Server version: 8.0.20
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

DROP DATABASE IF EXISTS cab302x;

CREATE DATABASE cab302x
	CHARACTER SET utf8mb4
	COLLATE utf8mb4_0900_ai_ci;

--
-- Set default database
--
USE cab302x;

--
-- Create table `billboard`
--
CREATE TABLE billboard (
  billboard_id INT NOT NULL AUTO_INCREMENT,
  billboard_name VARCHAR(35) NOT NULL,
  content VARCHAR(5120) NOT NULL,
  creator VARCHAR(25) DEFAULT NULL,
  user_id INT DEFAULT NULL,
  created TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (billboard_id),
  UNIQUE INDEX UK_billboard(billboard_name, billboard_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 15,
AVG_ROW_LENGTH = 1820,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci;

--
-- Create index `UK_billboard_billboard_name` on table `billboard`
--
ALTER TABLE billboard 
  ADD UNIQUE INDEX UK_billboard_billboard_name(billboard_name);

--
-- Create table `schedule`
--
CREATE TABLE schedule (
  schedule_id INT NOT NULL AUTO_INCREMENT,
  billboard_name VARCHAR(35) NOT NULL,
  billboard_id INT DEFAULT NULL,
  show_time TIME DEFAULT NULL,
  duration INT DEFAULT 0,
  every_day TINYINT DEFAULT 0,
  every_hour TINYINT DEFAULT 0,
  every_minute TINYINT DEFAULT 0,
  everyXminute INT DEFAULT 0,
  created TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (schedule_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 2730,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci;

--
-- Create index `UK_schedule_show_time` on table `schedule`
--
ALTER TABLE schedule 
  ADD UNIQUE INDEX UK_schedule_show_time(show_time);

--
-- Create foreign key
--
ALTER TABLE schedule 
  ADD CONSTRAINT FK_schedule FOREIGN KEY (billboard_name, billboard_id)
    REFERENCES billboard(billboard_name, billboard_id);

--
-- Create table `user`
--
CREATE TABLE user (
  user_id INT NOT NULL AUTO_INCREMENT,
  username VARCHAR(25) NOT NULL,
  password VARCHAR(255) NOT NULL,
  salt VARCHAR(255) NOT NULL,
  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (user_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 7,
AVG_ROW_LENGTH = 3276,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci;

--
-- Create index `username` on table `user`
--
ALTER TABLE user 
  ADD UNIQUE INDEX username(username);

--
-- Create table `role`
--
CREATE TABLE role (
  role_id INT NOT NULL AUTO_INCREMENT,
  role VARCHAR(30) NOT NULL,
  PRIMARY KEY (role_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 5,
AVG_ROW_LENGTH = 4096,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci;

--
-- Create table `permission`
--
CREATE TABLE permission (
  user_id INT NOT NULL,
  role_id INT NOT NULL,
  PRIMARY KEY (user_id, role_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 1638,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci;

--
-- Create foreign key
--
ALTER TABLE permission 
  ADD CONSTRAINT FK_permission_role_id FOREIGN KEY (role_id)
    REFERENCES role(role_id);

--
-- Create foreign key
--
ALTER TABLE permission 
  ADD CONSTRAINT FK_permission_user_id FOREIGN KEY (user_id)
    REFERENCES user(user_id);

DELIMITER $$

--
-- Create function `NoOfMinutesBetweenTimes`
--
CREATE DEFINER = 'root'@'localhost'
FUNCTION NoOfMinutesBetweenTimes(start_time TIME, end_time TIME)
  RETURNS INT(11)
  READS SQL DATA
BEGIN
  DECLARE minutes INT;

    SET minutes = MINUTE(TIMEDIFF(start_time, end_time));
    IF minutes < 0 THEN SET minutes = 0;
 END IF;

RETURN minutes;
END
$$

--
-- Create function `NoOfHoursBetweenTimes`
--
CREATE DEFINER = 'root'@'localhost'
FUNCTION NoOfHoursBetweenTimes(start_time TIME, end_time TIME)
  RETURNS INT(11)
  READS SQL DATA
BEGIN
  DECLARE hours INT;
    SET hours = HOUR(TIMEDIFF(start_time, end_time)) + 1;

RETURN hours;
END
$$

DELIMITER ;

-- 
-- Dumping data for table billboard
--
INSERT INTO billboard VALUES
(1, 'Billboard1', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#F2E0F7"><message colour="#FE2E64">Welcome to the Woolworths Annual Fundraiser!</message><picture url="images/financial.jpg"/><information colour="#819FF7">For more information check out https://woolworths.com.au/ for more information.</information></billboard>', 'super.u', 1, '2020-06-15 08:53:47'),
(2, 'Billboard2', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#1FBB24"><message colour="#FE2E64">Thought for the day "QSuper offers good financial performance"</message><picture url="images/tech.jpg"/><information colour="#801FBB">For more information check out https://billboards.com.au/ for more information.</information></billboard>', 'super.u', 1, '2020-06-15 09:01:39'),
(4, 'Billboard3', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#F8FC03"><message colour="#FE2E64">Welcome to the Coles Annual Fundraiser!</message><picture url="images/meeting.jpg"/><information colour="#1FBB87">For more information check out https://coles.com.au/ for more information.</information></billboard>', 'super.u', 1, '2020-06-15 09:47:32'),
(5, 'Billboard4', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#1FBB68"><message colour="#FE2E64">Welcome to Rockhampton Domestic Airport.</message><picture url="images/peoplewalking.jpg"/><information colour="#EEEE07">For more information check out https://billboards.com.au/ for more information.</information></billboard>', 'super.u', 1, '2020-06-15 11:54:14'),
(6, 'Billboard5', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#F2E0F7"><message colour="#FE2E64">An apple a day keeps the doctor away...</message><picture url="images/mountains.jpg"/><information colour="#819FF7">For more information check out https://billboards.com.au/ for more information.</information></billboard>', 'super.u', 1, '2020-06-15 11:57:35'),
(7, 'Billboard6', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#99F306"><message colour="#FE2E64">It''s a nice place on Hamilton Island...</message><picture url="images/beach.jpg"/><information colour="#A0C1FC">For more information check out https://billboards.com.au/ for more information.</information></billboard>', 'super.u', 1, '2020-06-15 11:58:03'),
(8, 'Billboard7', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#72F567"><message colour="#E4EEEE">Buy Samboy Chips, they are very very good...</message><picture url="images/rain.jpg"/><information colour="#67D3F5">For more information check out https://billboards.com.au/ for more information.</information></billboard>', 'super.u', 1, '2020-06-15 12:05:29'),
(9, 'Billboard8', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#F2FD04"><message colour="#0CDCF9">Energy Super retirement seminar</message><picture url="images/financial.jpg"/><information colour="#F66272">For more information check out https://billboards.com.au/ for more information.</information></billboard>', 'super.u', NULL, '2020-06-16 15:13:56'),
(10, 'Billboard9', '<?xml version="1.0" encoding="UTF-8" standalone="no"?><billboard background="#F8FC03"><message colour="#0CDCF9">UniSuper investment options seminar</message><picture url="images/financial.jpg"/><information colour="#F66272">For more information check out https://billboards.com.au/ for more information.</information></billboard>', NULL, NULL, '2020-06-17 21:35:40'),
(11, 'Billboard10', '<?xml version="1.0" encoding="UTF-8"?><billboard background="#D5E5E7"><picture url="images/lake.jpg"/></billboard>', NULL, NULL, '2020-06-19 11:43:58'),
(12, 'Billboard11', '<?xml version="1.0" encoding="UTF-8"?><billboard background="#D5E5E7"><information colour="#DAFC7E">Be sure to check out https://example.com/ for more information.</information></billboard>', NULL, NULL, '2020-06-19 11:45:14'),
(13, 'Billboard12', '<?xml version="1.0" encoding="UTF-8"?><billboard background="#D5E5E7"><message colour="#F7D291">Only a message to be viewed this time...</message></billboard>', NULL, NULL, '2020-06-19 11:46:47'),
(14, 'Billboard13', '<?xml version="1.0" encoding="UTF-8"?><billboard background="#D5E5E7"><picture url="images/matrix.jpg"/><information colour="#DAFC7E">Be sure to check out https://matrix.com.au/ for more information.</information></billboard>', NULL, NULL, '2020-06-19 11:48:29');

-- 
-- Dumping data for table user
--
INSERT INTO user VALUES
(1, 'super.u', '587bc3b62925f7ff5227a715d617f472', 'PnGcFzjkAGqFsJzaXgO5LA==', '2020-04-19 19:03:04'),
(3, 'stock.c', 'efdc633e5075831e26b5261c06cf98e3', 'OFqbyHAUv2YZtH48ck2Flg==', '2020-06-15 08:29:51'),
(4, 'jones.k', '0c777f15ecb2ef0bd8e7d3cf03730996', 'MJlYRAaA3HpIBW2RRFp72A==', '2020-06-15 12:08:43'),
(5, 'doe.j', '334ad475dc56efd13185d1669d2705ef', 'I3w3qncpDRcoUcf0N9owmA==', '2020-06-15 12:14:32'),
(6, 'limited.u', '1980c890fbf3259eb946a844a5da28a2', 'xMC+WHlks00qzmQGdFbETA==', '2020-06-16 18:42:47');

-- 
-- Dumping data for table role
--
INSERT INTO role VALUES
(1, 'Create Billboards'),
(2, 'Edit All Billboards'),
(3, 'Schedule Billboards'),
(4, 'Edit Users');

-- 
-- Dumping data for table schedule
--
-- Table cab302.schedule does not contain any data (it is empty)

-- 
-- Dumping data for table permission
--
INSERT INTO permission VALUES
(1, 1),
(3, 1),
(1, 2),
(3, 2),
(4, 2),
(1, 3),
(3, 3),
(1, 4),
(3, 4);

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;